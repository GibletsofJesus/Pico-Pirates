pico-8 cartridge // http://www.pico-8.com
version 16
__lua__

fillps={0b0101101001011010.1,
	0b111111111011111.1,
	0b1010010110100101.1,
	0b0101101001011010.1,
	0b0001000100000000.1,
	0B1111111111011111.1}

function _________built_in_funcitons()
		--remove me
end

local wind_dir=.125

function _init()
	vecs={}
	for _x=0,63 do
		local vec={}
		add(vecs,vec)
		for _y=0,63 do
			local _vx=rnd(0.75)+.25
			if (rnd(1)>.5) _vx*=-1
			local _vy=rnd(0.75)+.25
			if (rnd(1)>.5) _vy*=-1
			add(vec,{x=_x,y=_y,vx=_vx,vy=_vy})
		end
	end

	wind_ps={}
	for i=0,63 do
		local _prev={}
		for i=0, 8+rnd(16) do
			add(_prev,{x=-1,y=0})
		end
		add(wind_ps,{x=rnd(64),y=16+rnd(96),t=0,prev=_prev})
	end

	clouds={}
	local _dx=1
	local _dy=1
	if (rnd(1)>.5) _dx*=-1
	if (rnd(1)>.5) _dy*=-1
	for i=0,10 do
		add(clouds,{x=rnd(127),y=(127),dx=rnd(3)*_dx,dy=rnd(3)*_dy,r=4+rnd(10)})
	end
end

function _update()
	--update_wind()
	if (btnp(5)) update_vectors()
	for c in all(clouds) do
		c.x+=c.dx
		c.y+=c.dy
		if (c.x>127+c.r) c.x-=127+(c.r*2)
		if (c.y>127+c.r) c.y-=127+(c.r*2)
		if (c.x<0-c.r) c.x+=127+(c.r*2)
		if (c.y<0-c.r) c.y+=127+(c.r*2)
	end
end

function _draw()
	cls(12)
	if (btn(4)) _init()
	print(stat(1))
	--[[local smooth=1000
	if #wind_ps>1 then
		for i=2,#smooth do
			pset(lerp(wind_ps[i].x,wind_ps[i-1].x,(1/smooth)*(1+i)),
				lerp(wind_ps[i].y,wind_ps[i-1].y,(1/smooth)*(1+i)),7)
		end
	end]]--
	--draw_wind()
	--draw_vectors()
	for c in all(clouds) do
		fillp(fillps[2])
		circfill(c.x,c.y,c.r,7)
	end
	fillp()
end

function ______________________whind()
		--remove me
end

function update_wind()
	for w in all(wind_ps) do
			w.t+=0.0333
			for i=#w.prev,2,-1 do
				w.prev[i].x=w.prev[i-1].x
				w.prev[i].y=w.prev[i-1].y
			end
			w.prev[1].x=w.x
			w.prev[1].y=w.y
			if w.t>(.5-wind_dir) then
				w.x+=sin(wind_dir)
				w.y-=cos(wind_dir)
				if(rnd(1)>.99 and w.t>1) w.t=-1.25
			else
				w.x+=sin(w.t)
				w.y-=cos(w.t)
			end
			if (w.x>128+#w.prev)w.x-=127+#w.prev
			if (w.x<0-#w.prev)w.x+=127+#w.prev
			if (w.y>128+#w.prev)w.y-=127+#w.prev
			if (w.y<0-#w.prev)w.y+=127+#w.prev
	end
end

function draw_wind()
	for w in all(wind_ps) do
			pset(w.x,w.y,7)
			for p in all(w.prev) do
				pset(p.x,p.y,7)
			end
	end
end

function lerp(a,b,t)
	return a+t*(b-a)
end

_fillp_original=fillp
function fillp(pattern,x,y)
    local add_bits=band(pattern,0x0000.ffff)
    pattern=band(pattern,0xffff)
    y=flr(y)%4
    if(y~=0)then
        local r={0xfff0,0xff00,0xf000}
        local l={0x000f,0x00ff,0x0fff}
        pattern=bxor(lshr(band(pattern,r[y]),y*4),shl(band(pattern,l[y]),(4-y)*4))
    end

    x=flr(x)%4
    if(x~=0)then
        local r={0xeeee,0xcccc,0x8888}
        local l={0x1111,0x3333,0x7777}
        pattern=bxor(lshr(band(pattern,r[x]),x),shl(band(pattern,l[x]),4-x))
    end

    return _fillp_original(bxor(pattern,add_bits))
end

function ________________Vector_tings()
		--remove me
end

function update_vectors()
	for _x=2,#vecs-1 do
		for _y=2,#vecs[_x]-1 do
				vecs[_x][_y].vx =
					(vecs[_x+1][_y].vx +
					vecs[_x-1][_y].vx +
					vecs[_x][_y-1].vx +
					vecs[_x][_y-1].vx +
					vecs[_x][_y].vx)/5
				vecs[_x][_y].vy =
					(vecs[_x+1][_y].vy +
					vecs[_x-1][_y].vy +
					vecs[_x][_y-1].vy +
					vecs[_x][_y-1].vy +
					vecs[_x][_y].vy)/5
		end
	end
end

function draw_vectors()
		for vec in all(vecs) do
			for v in all(vec) do
				local _x=8+v.x*16
				local _y=8+v.y*16

				local smooth=20

				if (_x>8 and _x<120 and _y>8 and _y<120) then
					--circfill(_x,_y,1,2)
					--line(_x,_y,_x+v.vx*16,_y+v.vy*16,8)

					local s=sin(atan2(flr(v.vx*smooth	)/smooth,flr(v.vy*smooth)/smooth))
					local c=cos(atan2(flr(v.vx*smooth)/smooth,flr(v.vy*smooth)/smooth))
					--local s=v.vx
				  --local c=v.vy
				  local _b=s*s+c*c
				  local size = 8/2
				  local w = sqrt(size^2*2)
				  for y=-w,w do
				    for x=-w,w do
				      local ox=( s*y+c*x)/_b+size
				      local oy=(-s*x+c*y)/_b+size
				      local col=sget(ox+28,oy+4)
				      if col>0 then
							 			pset(_x+x,_y+y+1,6)
				       pset(_x+x,_y+y,7)
				      end
				    end
				  end

				end
			end
		end
end

__gfx__
00000000700000000000000770000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000004000000000000006600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000004000000000000066660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700000000004f400000000000666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007000000004fff40000000006666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000477740000000000066660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000007f4f70000000000066660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000004fff40000000000066660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000777770000000000066660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000074f4f47000000000066660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000049f940000000000066660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000499940000000000066660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000700000000000000770000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aae5fba057770008eff908ff7daa0bffd9005dddd046617760000000000000000000000000000000000000000000000000000000000000000000000000000000
0e501e088528d804d284008700f00c708500e14ad006320600000000000000000000000000000000000000000000000000000000000000000000000000000000
06b3b60085f580050a04000f6e10007d4000a3d2a007023700000000000000000000000000000000000000000000000000000000000000000000000000000000
070816008d28900582850007807040b04e00a1e8a007002700000000000000000000000000000000000000000000000000000000000000000000000000000000
23edf320df7b8008dfd8007ff9600ffffb023dde2222755200000000000000000000000000000000000000000000000000000000000000000000000000000000
10000000000000022004400000060000001000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000
00000001100000000000000000000000000008800000000000000000000008880000000008880000000000000000000022200000000002220002220000000000
00000811000000000000000000000000000002aa750aaa008801777740000008e73b9800006ff753aa80001bbffdd10000675555572000466515740000000000
000088900000000000000000000000000000002e9550a00009d40aa9d48800049e6090004512a845380000097208d10000623540370000067200700000000000
0008c8880000000000000000000020000044006f8114b100008817e9140800459a2c00000006f906910000017688010000223540230000077200600000000000
000cc88800000000000000000002200000440467993b6000008817fd400804551aa040000006fd68110000013ec5000000203743020000175220600000000000
0044e98002000000023400000022650000040067aa19640000089f69908000451aa0440000067be011000001bb15400000203753020000075221700000000000
0046ffd42220022227777222002677775440007608817000000097609900004592a840000006798710000001fa01060000201761020000075022700000000000
0467ffd72222002453777720027727775510003608853000000097619800000c12ac0100000679871000000db200c20000201760020000065022700000000000
0246fbb022200065510776400577200115100133ecdb33000009ff7f88800088c77d90000047ff9960000019ffffb31002225554222000226557200000000000
00467b10020000475102764005772000511002000000000000000000000000000200c40000200000060000020000000000010000000000000000200000000000
00467b10000000475102264405772004111000000000000000000000000000222000088000000000006600000000000000000000000000000000022000000000
00467b10000000677102260005772044551000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00467b10000002655306620005776044555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00467b10000002655162220005776404555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00467b10000022655502220001776000555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00467310000022655102220001336000555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00467b10000022655102220001372000555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0046fb90100022675122224011733000555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
046effbd200026777753272213777752510000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0046fff2000002267557720004677775000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00004b00000000200410200040002150000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00011111000010001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00111111100010111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01000011110011111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000001110110000111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000001111010000011110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000001110010000001111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000011110010000000111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000101110010000000111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00011001110011000001111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00111001110010111110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01111101110010000000111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00011111110010000000111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00001111110010000000111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000011110010111110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000011110011000001111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000001110010000000111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000001110010000000111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000001110010000000111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000111110011110000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00011111110011111110100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01111111110011111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11000001110010000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000001110010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000001110010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000001110010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000001111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
090a0a0a0a0b00090a0a0a0a0a0a0a0b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
192d2d2d2d1b00192d2d2d2d2d2d2d1b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
191a1a1a1a1c0a1d1a1a1a1a1a1a1a1b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
191a1a1a1a3c3d3e1a1a1a1a1a1a1a1b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
191a1a051a1a1a1a1a1a0c0d1a1a1a1b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
191a1a1a1a0c2a0d1a1a1b191a1a1a1b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
292a2a2a2a2b00292a2a2b191a0c2a2b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
090a0a0a0b090a0a0a0a0b09380b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
192d2d2d1b192d2d2d2d1c1d2d1b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
191a1a1a1b191a0c0d1a2c2e1a1b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
191a1a1a1c1d1a1b191a1a1a1a1b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
191a1a1a2c2e1a1b292a2a2a2a2b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
191a1a1a1a1a1a1b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
191a1a1a0c2a2a2b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
191a1a1a1b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
292a2a2a2b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
